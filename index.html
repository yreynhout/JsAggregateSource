<html>
<head>
<script src="scripts/json2.min.js"></script>
<script src="scripts/store.min.js"></script>
<script src="scripts/aggregatesource.js"></script>
<script src="scripts/model.js"></script>
<script>
if (!store.enabled) {
	console.error("Local storage is not supported by your browsa - No demo for you.");
} else {
	store.set('item/1', []);

	//First command
	var original = new Model.InventoryItem('item/1', 'Boxer shorts');
	original.checkIn(5);
	var originalChanges = original.getChanges();
	for(var index = 0, length = originalChanges.length; index < length; index++) {
		console.info(JSON.stringify(originalChanges[index]));
	}
	store.set('item/1', originalChanges);

	//Second command
	var loadedChanges = store.get('item/1');
	var loaded = new Model.PrivateInventoryItemConstructor();
	loaded.initialize(loadedChanges);
	loaded.checkIn(2);
	var newChanges = loaded.getChanges();
	for(var index = 0, length = newChanges.length; index < length; index++) {
		console.info(JSON.stringify(newChanges[index]));
	}
	store.set('item/1', originalChanges.concat(newChanges));

	//Third command
	var reloadedChanges = store.get('item/1');
	var reloaded = new Model.PrivateInventoryItemConstructor();
	reloaded.initialize(reloadedChanges);
	reloaded.deactivate();
	var newestChanges = reloaded.getChanges();
	for(var index = 0, length = newestChanges.length; index < length; index++) {
		console.info(JSON.stringify(newestChanges[index]));
	}
	store.set('item/1', reloadedChanges.concat(newestChanges));	
}
</script>
</head>
<body></body>
</html>